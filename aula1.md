Primeiro é necessário a criação do ambiente virtual, por isso vamos usar.

```jsx
python3 -m venv venv

Após isso é necessários ativar o ambiente virtual para instalarmos as bibliotecas necessárias.

```jsx
#LINUX
source venv/bin/activate

#WINDOWS
venv\Scripts\activate.bat
#OU
venv\Scripts\Activate.ps1
```
Criar o ambiente virtual e ativa-lo, é interessante e importante, pois permite que se instale as bibliotecas
do projeto neste ambiente virtual e NÃO no Python geral do sistema.


Com o ambiente ativo só nos falta instalar as bibliotecas.

```jsx
pip install django pillow
```

Agora precisamos criar a estrutura base do projeto Django, ou seja devemos utilizar.

```jsx
django-admin startproject imersaoPython .
// O "espaço ponto" no final é necessário para que o Django organise todos os arquivos dentro de uma única pasta
// O Django criará a 'pasta imersaoPython' e o arquivo 'manage.py'
```

Feito isso é necessário criar os APP'S no qual será dividido nossa aplicação, sendo assim vamos rodar o comando. (O Django trabalha com aplicações)

```jsx
python3 manage.py startapp produto // estamos criando a aplicação 'produto'
```

Agora dentro da pasta imersaoPython teremos o arquivo [settings.py](http://settings.py) e vamos definir nele algumas configurações que a maioria dos projetos Django devem utilizar.

```python
"""
Django settings for imersaoPython project.

Generated by 'django-admin startproject' using Django 3.2.4.

For more information on this file, see
https://docs.djangoproject.com/en/3.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/3.2/ref/settings/
"""

from pathlib import Path
import os
# Build paths inside the project like this (Construa caminhos dentro do projeto como este): BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent

# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/3.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-x3$w+jy4lnx9jaj&sbk4vaeg@1xk^-+z=$pcno6k=d8vsc#m6g'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []

# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'produto', # adicionando a aplicação criada produto - isso deve ser feito todas as vezes que for criada uma nova aplicação
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'imersaoPython.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [os.path.join(BASE_DIR, 'templates')],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
            
        },
    },
]

WSGI_APPLICATION = 'imersaoPython.wsgi.application'

# Database
# https://docs.djangoproject.com/en/3.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

# Password validation
# https://docs.djangoproject.com/en/3.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]

# Internationalization
# https://docs.djangoproject.com/en/3.2/topics/i18n/

LANGUAGE_CODE = 'pt-BR'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_L10N = True

USE_TZ = True

# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/3.2/howto/static-files/

STATIC_URL = '/static/'
STATICFILES_DIRS = (os.path.join(BASE_DIR, 'templates/static'),)
STATIC_ROOT = os.path.join('static')

MEDIA_ROOT = os.path.join(BASE_DIR,'media')
MEDIA_URL = '/media/'

SESSION_COOKIE_AGE = 60*60*24*7

SESSION_SAVE_EVERY_REQUEST = False

# Default primary key field type
# https://docs.djangoproject.com/en/3.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
```
 Nota: para rodar o servidor usamos o comando:

```python
python manage.py runserver
```
Agora com todas as configurações iniciais feitas podemos criar nossa primeira URL para alguma página html. E para isso nós vamos dentro da pasta imersaoPython abrir o arquivo [urls.py](http://urls.py) e criar uma URL apontando para nosso APP produto.

```python
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('produto.urls')), # url criada para apontar par o APP produto
]
urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)
urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

Agora dentro do APP produto vamos criar o arquivo urls.py

```python
from django.urls import path
from . import views # O ponto (.) indica a raiz do nosso projeto.

urlpatterns = [
    path("", views.home, name='home'),
]
```

Sendo assim precisamos criar a função home dentro do arquivo views que acabamos de chamar.

```python
from django.shortcuts import render
from django.http import HttpResponse
# Create your views here.

def home(requests):
    return HttpResponse('Olá')
```

Feito isso se executarmos o comando

```python
python3 manage.py runserver
```

e acessarmos no navegador a url 127.0.0.1:8000 deve aparecer na tela a mensagem olá.

Mas a mensagem 'olá' não é um html que nós criamos, para renderizamos páginas em html vamos criar o diretório templates dentro do nosso APP produto, e agora dentro dele podemos criar nossos arquivos html. Ficando dessa forma:

```python
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Olá {{nome}}, tudo bem ?</h1>
</body>
</html>
```

```python
from django.shortcuts import render
from django.http import HttpResponse

def home(request):
    return render(request, 'teste.html', {'nome': 'caio'})
```

Ok, o que fizemos até aqui foi mais para te mostrar como o Django funciona e não tinha muita relação com nosso projeto de Delivery em específico. Vamos focar então no nosso projeto, eu costumo começar criando o banco de dados e a área administrativa primeiro.

Primeiro vamos modelar a base de dados e para isso vamos abrir o arquivo models.py;

```python
from django.db import models
from datetime import datetime
from django.utils.safestring import mark_safe

class Categoria(models.Model):
    categoria = models.CharField(max_length=200)

    def __str__(self):
        return self.categoria

class Opcoes(models.Model):
    nome = models.CharField(max_length=100)
    acrecimo = models.FloatField(default=0)
    ativo = models.BooleanField(default=True)
    def __str__(self):
        return self.nome

class Adicional(models.Model):
    nome = models.CharField(max_length=100, unique=True)
    maximo = models.IntegerField()
    minimo = models.IntegerField()
    opcoes = models.ManyToManyField(Opcoes)
    ativo = models.BooleanField(default=True)
    def __str__(self):
        return self.nome

class Produto(models.Model):
    nome_produto = models.CharField(max_length=500)
    img = models.ImageField(upload_to='post_img')
    categoria = models.ForeignKey(Categoria, on_delete=models.CASCADE)
    preco = models.FloatField()
    descricao = models.TextField()
    ingredientes = models.CharField(max_length=2000)
    adicionais = models.ManyToManyField(Adicional, blank=True)
    ativo = models.BooleanField(default=True)

    @mark_safe
    def icone(self):
        return f'<img width="30px" src="/media/{self.img}">'

    def __str__(self):
        return self.nome_produto
```

Agora para efetuar essas alterações no banco de dados devemos executar dois comandos:

```python
python3 manage.py makemigrations
#E
python3 manage.py migrate
```

Feito isso nós temos as respectivas tabelas criadas no banco de dados.

Agora precisamos começar a criar a área administrativa e nós vamos utilizar a área que o Django já disponibiliza pra gente, então no arquivo admins.py:

```python
from django.contrib import admin
from .models import Categoria, Produto, Adicional, Opcoes

@admin.register(Produto)
class ProdutoAdmin(admin.ModelAdmin):
    list_display = ('icone', 'nome_produto', 'categoria', 'preco', 'ativo')
    list_editable = ('preco','ativo')

admin.site.register(Categoria)
admin.site.register(Adicional)
admin.site.register(Opcoes)
```

Com isso nós já temos uma área administrativa para cadastro dos produtos, porém precisamos criar um login e senha de um usuário root:

```python
python3 manage.py createsuperuser
```

Pronto, agora basta acessar 127.0.0.1:8000/admin que terá acesso a sua área administrativa.

Mas Ok, agora falta a tela onde o cliente do restaurante vai visualizar o cardápio. primeiro vamos criar uma base html que todas as outras página iram herdar dela:

```python
{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" >
    <link rel="stylesheet" href="{% static 'produto/css/css.css' %}" >
    <script src="{% static 'pedido/js/js.js' %}"></script>
    {% block 'head'%}

    {% endblock %}
    <title>Fondue delícia</title>

  </head>
  <body>

    
    <nav class="navbar navbar-expand-lg navbar-light corBorda">
        <a class="navbar-brand" href="{% url 'home'%}">Fondue delícia</a>
        <a class="navbar-brand" href="#">0x<svg xmlns="http://www.w3.org/2000/svg"width="1.2em" height="1.2em" fill="currentColor" class="bi bi-cart3" viewBox="0 0 16 16">
          <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
        </svg></a>
        
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
           
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Categorias
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            
                <a class="dropdown-item" href="#">categoria 1</a>
               
              </div>
            </li>
          </ul>
        </div>
      </nav>

      {% block 'conteudo' %}

      {% endblock %}

     
      <br>
      <br>
      <br>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

 
  </body>
</html>
```

Agora se na home.html extendermos o arquivo base.html

```python
{% extends 'base.html' %}

{% block 'conteudo'%}
<h1>Olá {{nome}}, tudo bem ?</h1>
{%endblock%}
```

Teremos a barra de navegação sem precisar replicar o código html dela em home.html.

Para listarmos todos os produtos cadastrados precisamos preparar a lógica dos dados e isso será feito em views.py:

```python
from django.shortcuts import render
from django.http import HttpResponse
from .models import Produto, Categoria, Opcoes, Adicional

def home(request):
    if not request.session.get('carrinho'):
        request.session['carrinho'] = []
        request.session.save()
    produtos = Produto.objects.all()
    categorias = Categoria.objects.all()
    return render(request, 'home.html', {'produtos': produtos,
                                        'carrinho': len(request.session['carrinho']),
                                        'categorias': categorias,
                                        })
```

Agora em base.html podemos mostrar todas as categorias e o tamanho do carrinho

```python
{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" >
    <link rel="stylesheet" href="{% static 'produto/css/css.css' %}" >
    <script src="{% static 'pedido/js/js.js' %}"></script>
    {% block 'head'%}

    {% endblock %}
    <title>Fondue delícia</title>

  </head>
  <body>

    
    <nav class="navbar navbar-expand-lg navbar-light corBorda">
        <a class="navbar-brand" href="{% url 'home'%}">Fondue delícia</a>
        <a class="navbar-brand" href="#">{{carrinho}}x<svg xmlns="http://www.w3.org/2000/svg"width="1.2em" height="1.2em" fill="currentColor" class="bi bi-cart3" viewBox="0 0 16 16">
          <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
        </svg></a>
        
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav">
           
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Categorias
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            
                {% for i in categorias %}
                <a class="dropdown-item" href="#">{{i}}</a>
                {%endfor%}
               
              </div>
            </li>
          </ul>
        </div>
      </nav>

      {% block 'conteudo' %}

      {% endblock %}

     
      <br>
      <br>
      <br>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

 
  </body>
</html>
```

E em home.html podemos listar todos os produtos

```python
{%extends 'base.html'%}

{% block 'conteudo'%}
<div class="container">
    <div class="row">
    {% for produto in produtos %}

        {% if produto.ativo %}
      <div class="col-sm">
        <div class="cont">
            <img style="width: 350px; margin-top: 20px;" src="/media/{{produto.img}}">
        </div>
        <h1 style="width: 350px;" class="nome titulo bordaBottom">{{produto.nome_produto}}</h1>
        <h2 class="rosa">Descrição:</h2>
        <h5 style="width: 350px; color: gray;" class="descricao bordaBottom">{{produto.descricao}}</h5>
        <h1 class="rosa">R$ {{produto.preco}}0</h1>
        <br>
        <a style="margin-top: 20px;" href="" class="botao">Adicionar ao carrinho</a>
        <br>
      </div>
      {% endif %}
      {% endfor %}  
      
      
    </div>
  </div>
{%endblock%}
```

Mas agora está claramente faltando o css da página, vamos criar o arquivo css.css dentro de templates/static/produto

```css
.corBorda{
    background-color: #F6DCE1;
}

.observacoes{

    border: 1px solid #E58383;
    width: 200px;

}

.tituloProduto{

font-size: 60px;
}

.subTituloProduto{

    font-size: 40px;
}

.bordaBottom{

border-bottom: 1px solid gray;
padding-bottom: 20px;

}

.botao{

    background-color: #F69E9E;
    color: white;
    padding: 8px;
    border-radius: 15px;
    transition: 0.2s;
}

body{
    background-color: #FAF9F9;
}

.titulo{

    color: #E58383;

}

.botao:hover{
    color: white;
    text-decoration: none;
    padding: 10px;
    border: 1px solid #E64747;
}

.cont{
    
    overflow:auto;
    width: 350px;

  }

.cont img {
    max-width: 100%;
    -moz-transition: all 2s;
    -webkit-transition: all 2s;
    transition: all 2s;
  }

.cont:hover img {
    -moz-transform: scale(1.8);
    -webkit-transform: scale(1.8);
    transform: scale(1.8);
  }

input[type=checkbox] {
    position: relative;
    cursor: pointer;
    border: 1px solid #F2A1A1;
    color: black;
        
    }
    
input[type=checkbox]:before {
    content: "";
    border-radius: 15px;
    border: 1px solid #F2A1A1;
    display: block;
    position: absolute;
    width: 25px;
    height: 25px;
    top: 0;
    left: 0;
    color: black;
    background-color: #FAEDED;
    }
    
input[type=checkbox]:checked:after {
    content: "";
    display: block;
    width: 5px;
    height: 10px;
    border: 1px solid #BC3535;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
    position: absolute;
    top: 5px;
    left: 9px;
}

.tamanhoImg{
    width: 500px;
}

@media (max-width: 1200px)
{
 
    .tamanhoImg{

        width: 300px;
    
    }

}
```

Agora vamos filtrar os produtos por categoria e para isso vamos criar uma URL para as categorias:

```python
from django.urls import path
from . import views

urlpatterns = [
    path("", views.home, name='home'),
    path("categoria/<int:id>", views.categorias, name='categoria'),
]
```

Em base.html vamos chamar essa URL passando o id da categoria como parametro:

```python
{% for i in categorias %}
    <a class="dropdown-item" href="{% url 'categoria' i.id%}">{{i}}</a>
{%endfor%}
```

Só ficou faltando criar a view que vai ficar responsável em criar a lógica para filtrar os dados.

```python
def categorias(request, id):
    produtos = Produto.objects.filter(categoria_id = id)
    categorias = Categoria.objects.all()

    return render(request, 'home.html', {'produtos': produtos,
                                        'carrinho': len(request.session['carrinho']),
                                        'categorias': categorias,})
```

Para finalizarmos por hoje precisamos que ao clicar em "adicionar ao carrinho" seja aberto uma nova página com as informações apenas do produto clicado, para que ele possa finalizar o pedido.    e para isso primeiro vamos adicionar em home.html:

```python
<a style="margin-top: 20px;" href="{% url 'produto' produto.id%}" class="botao">Adicionar ao carrinho</a>
```

E agora vamos criar a URL produto:

```python
path("produto/<int:id>", views.produto, name='produto'),
```

Agora precisamos criar a view produto

```python
def produto(request, id):
    if not request.session.get('carrinho'):
        request.session['carrinho'] = []
        request.session.save()
    erro = request.GET.get('erro')
    produto = Produto.objects.filter(id=id)[0]
    categorias = Categoria.objects.all()
    return render(request, 'produto.html', {'produto': produto, 
                                            'carrinho': len(request.session['carrinho']),
                                            'categorias': categorias,
                                            'erro': erro})
```

Percebe-se que a view produto chama o arquivo html produto.html, precisamos cria-lo:

```python
{%extends 'base.html'%}

{%block 'head'%}
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
{%endblock%}

{% block 'conteudo'%}
<div style="align-items: center; text-align: center;">
    <div class="container">
        {% if erro == '1'%}
        <br>
        <br>
        <div class="alert alert-danger" role="alert">
            Confira a quantidade de adicionais selecionados
        </div>
    {%endif%}

    </div>
    <img class="tamanhoImg" style="margin-top: 20px;" src="/media/{{produto.img}}">
    
    <h3  class="titulo tituloProduto">{{produto.nome_produto}}</h3>
    <hr style="width: 250px;">
    <h1 class="titulo subTituloProduto">Descrição: </h1>
    <h3 style="color: gray;">{{produto.descricao}}</h3>
    <h1 class="titulo subTituloProduto">Ingredientes: </h1>
    <h3 style="color: gray;">{{produto.ingredientes}}</h3>

    <h1 class="titulo subTituloProduto">Escolha seus adicionais: </h1>

    <form method="POST" action="#">{% csrf_token %}
    <input name="id" style="display: none;" type="text" value="{{produto.id}}">
    {% for i in produto.adicionais.all %}
    <h1>{{i}}</h1>
    <p>Escolha no mínimo {{i.minimo}} e no máximo {{i.maximo}} {{i}}</p>
        {%for j in i.opcoes.all%}
            {%if j.ativo%}
                <div>
                <input type="checkbox" class="checkbox" name="{{i}}" value={{j.id}}>
                <label for="scales">&nbsp&nbsp&nbsp{{j}} + R${{j.acrecimo}}</label>
                </div>
                <br>
            {%endif%}
        {%endfor%}
    {% endfor %}
    <h1 class="titulo subTituloProduto">Observações: </h1>
    <input name="observacoes" class="observacoes" type="text">

    <h1 class="titulo subTituloProduto">Quantidade: </h1>
    <input name="quantidade" class="observacoes" type="number"  min="1" max="200" value="1">

    <h1 class="titulo subTituloProduto">Preço: </h1>
    <h3>R${{produto.preco}} Unidade</h3>

    <input class="botao" type="submit" value="Adicionar carrinho">
</form>

</div>

{%endblock%}
```

E pronto, com isso finalizamos a primeira aula da Imersão Python. Qualquer dúvida que tenha tido até aqui, estou a disposição para ajuda-lo lá no grupo do Discord e WhatsApp.